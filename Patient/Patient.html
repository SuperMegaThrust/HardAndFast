<head>
  <title>Patient</title>
</head>

<body>
	{{> tempBody}}
</body>

<template name="tempBody">
	{{> loginButtons}} 

	{{#unless currentUser}}
		<input type="checkbox" checked="{{ispatient}}" class="patientCheck">
		<label>Patient?</label>
	{{/unless}}

	{{#if currentUser}}
		{{#if isPatient}}
	  		<h1>Patient</h1>
	  		{{> tempUserID}}
			{{> doctor}}
		   	{{> measurements}}
		{{/if}}

		{{#unless isPatient}}
	  		<h1>Doctor</h1>
  			{{> drPatients}}
  			{{> tempAllUsers}}
		{{/unless}}		
	{{/if}}

</template>

<!-- DOCTOR SECTION -->

<template name="drPatients">
	<p>Welcome Dr {{loggedInDoctor}}</p>

	<form class="new-patient">
    	<input type="text" name="patientID" placeholder="Enter your new patient ID" />
 	</form>

 	{{DoctorsPatients}}
</template>

<template name="tempAllUsers">
 	<p>My patients</p>
 	{{#each patientsLinked}}
 		<li class="myPatients {{selectedClass}}">{{patientID}} &nbsp; &nbsp; {{patientName}}</li>
 	{{/each}}
	{{#if selectedPatient}}
		{{> chat recipient=selectedPatient}}
	{{/if}}
 	<table class="measurements {{hidden}}">
		<thead>
			<tr>
				<th>Date</th>
				<th>Blood Pressure</th>
				<th>Heart Rate</th>
				<th>Weight</th>
			</tr>
		</thead>
		<tbody>
			{{#each userMeasurements}}
				<tr>
					<td>{{date}}</td>
					<td>{{bloodPressure}}</td>
					<td>{{heartRate}}</td>
					<td>{{weight}}</td>
				</tr>
			{{/each}}
		</tbody>
	</table>
 	<p>All users</p>
 	{{#each allUsers}}
 		<p>{{_id}} --- {{profile.name}}</p> 
 	{{/each}}
</template>

<!-- END DOCTOR SECTION -->


<!-- PATIENT SECTION -->
<template name="tempUserID">
		<p>Welcome {{loggedInPatient}}, please add your measurements</p>
		Give this ID to your doc yo - {{tempUserID}}
</template>

<template name="doctor">
	Your doctor is: {{doctor.doctorID}}
	{{> chat recipient=doctor.doctorID}}
</template>

<template name="measurements">
	<form class="submit-measurements">
		{{#each fields}}
			<p>{{label}}</p> 
			<input name="{{name}}" value={{value}} />
		{{/each}}
		<br><br>
		<input type="submit" value="Submit Measurements" />
	</form>
	<table class="measurements">
		<thead>
			<tr>
				<th>Date</th>
				<th>Blood Pressure</th>
				<th>Heart Rate</th>
				<th>Weight</th>
			</tr>
		</thead>
		<tbody>
			{{#each measurements}}
				<tr>
					<td>{{date}}</td>
					<td>{{bloodPressure}}</td>
					<td>{{heartRate}}</td>
					<td>{{weight}}</td>
				</tr>
			{{/each}}
		</tbody>
	</table>
</template>

<!-- END PATIENT SECTION -->

<template name="chat">
	<div class="chat-panel">
		<div class="chat-messages">
			{{#each messages}}
				<p>{{fromUserId}}: {{text}}</p>
			{{/each}}
		</div>
		<form class="chat-controls">
			<input class="chat-message" type="text" name="message" />
			<input class="chat-send-message" type="submit" value="Send!" />
		</form>
	</div>
</template>
